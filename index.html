<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>VOO Cat Tracker - Final Accurate Edition</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --up-accent: #00c805;    
            --down-accent: #ff3b30;  
            --text-black: #000000;   
            --digit-h: 80px; 
        }

        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Inter", sans-serif; 
            background-color: #f8fafb; color: var(--text-black);
            text-align: center; padding: 10px; margin: 0;
            transition: background-color 0.4s ease;
        }
        
        /* ÁΩÆ‰∏≠Âç°Áâá‰∏îÂÖ∑ÂÇô RWD ÈÅ©ÈÖçÊÄß */
        .container { 
            background: #ffffff; border-radius: 28px; padding: 24px 16px; 
            box-shadow: 0 4px 25px rgba(0,0,0,0.08); 
            width: 92%; max-width: 360px; margin: 10px auto;
        }

        .subtitle { font-size: 11px; color: #888; margin-bottom: 8px; font-weight: 700; letter-spacing: 1px; }
        #cat-wrapper { height: 90px; display: flex; align-items: center; justify-content: center; margin-bottom: 5px; animation: cat-glow 3s infinite ease-in-out; }
        #cat-container { width: 80px; height: 80px; }

        /* Á¥îÈªëÊï∏Â≠óÔºö‰∏çÁïôÁÅ∞Ëâ≤ */
        .odometer {
            display: flex; justify-content: center; align-items: center;
            font-weight: 800; color: var(--text-black) !important;
            font-size: 50px; height: var(--digit-h); overflow: hidden;
        }
        .symbol { font-size: 26px; color: var(--text-black) !important; margin-right: 4px; font-weight: 800; }
        .digit-container { position: relative; width: 0.62em; height: var(--digit-h); overflow: hidden; }
        .digit-strip { position: absolute; width: 100%; transition: transform 0.8s cubic-bezier(0.23, 1, 0.32, 1); }
        .digit-strip span { display: block; height: var(--digit-h); line-height: var(--digit-h); text-align: center; color: var(--text-black) !important; }
        .decimal-point { width: 0.25em; line-height: var(--digit-h); color: var(--text-black) !important; font-weight: 800; }

        #change-display { font-size: 18px; font-weight: 800; margin-top: 4px; display: flex; align-items: center; justify-content: center; gap: 4px; }
        .up-text { color: var(--up-accent) !important; }
        .down-text { color: var(--down-accent) !important; }

        .trend-card {
            background: #ffffff; border-radius: 28px; padding: 20px; 
            box-shadow: 0 4px 25px rgba(0,0,0,0.05); 
            width: 92%; max-width: 360px; margin: 10px auto;
        }
        .trend-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .trend-title { font-size: 13px; font-weight: 700; color: #000; }
        #api-status { font-size: 9px; color: #aaa; font-weight: normal; }
        select { padding: 4px 8px; border-radius: 8px; border: 1px solid #ddd; font-size: 12px; font-weight: 700; background: #fff; color: #000; outline: none; }

        .chart-card { 
            background: #ffffff; border-radius: 28px; padding: 20px; 
            box-shadow: 0 4px 25px rgba(0,0,0,0.05); 
            width: 92%; max-width: 360px; margin: 0 auto 40px auto;
        }
        .chart-container { width: 140px; margin: 0 auto; }
        #custom-legend { display: grid; grid-template-columns: 1fr 1fr; gap: 10px 12px; margin-top: 20px; text-align: left; font-size: 11px; color: #000; }
        .legend-item { display: flex; align-items: center; gap: 6px; }

        @keyframes cat-glow { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
        .cat-jump { animation: cat-up-jump 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .cat-fall { animation: cat-down-fall 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes cat-up-jump { 0% { transform: translateY(0); } 50% { transform: translateY(-25px); } 100% { transform: translateY(0); } }
        @keyframes cat-down-fall { 0% { transform: translateY(0); } 50% { transform: translateY(20px); } 100% { transform: translateY(0); } }
    </style>
</head>
<body>

    <div class="container">
        <div class="subtitle">VOO MARKET TRACKER</div>
        <div id="cat-wrapper">
            <div id="cat-container">
                <svg viewBox="0 0 100 100"><circle cx="50" cy="50" r="42" fill="#f0f0f0"/><text x="50" y="78" font-size="55" text-anchor="middle">üê±</text></svg>
            </div>
        </div>
        <div class="odometer" id="odometer">
            <span class="symbol">$</span>
            <div id="digits-box" style="display:flex;"></div>
        </div>
        <div id="change-display">
            <span id="arrow"></span>
            <span id="change-text">---</span>
        </div>
    </div>

    <div class="trend-card">
        <div class="trend-header">
            <div class="trend-title">Price Trend <span id="api-status">Connecting...</span></div>
            <select id="timeframe" onchange="getVOOHistory()">
                <option value="1">1D</option>
                <option value="5">5D</option>
                <option value="30">1M</option>
                <option value="365">1Y</option>
                <option value="1825">5Y</option>
                <option value="max">Max</option>
            </select>
        </div>
        <div style="height: 180px;">
            <canvas id="trendChart"></canvas>
        </div>
    </div>

    <div class="chart-card">
        <div class="chart-container"><canvas id="holdingsChart"></canvas></div>
        <div id="custom-legend"></div>
    </div>

    <script>
        const API_KEY = 'd6ca1e9r01qsiik1clhgd6ca1e9r01qsiik1cli0'; 
        const symbol = 'VOO';
        let lastPrice = 0;
        let trendChart;

        async function getVOOHistory() {
            const timeframe = document.getElementById('timeframe').value;
            const to = Math.floor(Date.now() / 1000);
            let from, res;

            if (timeframe === 'max') {
                from = 1283817600; // 2010 
                res = 'M'; 
            } else {
                const days = parseInt(timeframe);
                from = to - (days * 24 * 60 * 60);
                res = days <= 1 ? '60' : (days >= 1825 ? 'W' : 'D');
            }

            document.getElementById('api-status').innerText = "Updating...";

            try {
                const response = await fetch(`https://finnhub.io/api/v1/stock/candle?symbol=${symbol}&resolution=${res}&from=${from}&to=${to}&token=${API_KEY}`);
                const data = await response.json();
                
                if (data.s === "ok") {
                    document.getElementById('api-status').innerText = "Live Data";
                    const prices = data.c;
                    const labels = data.t.map(ts => {
                        const d = new Date(ts * 1000);
                        if (timeframe === '1') return `${d.getHours()}:00`;
                        if (timeframe === 'max' || timeframe === '1825') return d.getFullYear();
                        return `${d.getMonth()+1}/${d.getDate()}`;
                    });
                    updateTrendUI(prices, labels);
                } else {
                    document.getElementById('api-status').innerText = "Simulated";
                    generateFallbackTrend(timeframe);
                }
            } catch (e) { generateFallbackTrend(timeframe); }
        }

        function generateFallbackTrend(tf) {
            // ‰øÆÊ≠£ÔºöÂü∫Ê∫ñÂÄºÊîπÁÇ∫Ê≠£Á¢∫ÁöÑ 614ÔºåÂÑ™ÂÖà‰ΩøÁî®Âç≥ÊôÇÂÉπÊ†º
            const base = lastPrice || 614; 
            let prices = [];
            let labels = [];
            let now = new Date();
            let count = (tf === 'max') ? 12 : (tf === '1' ? 8 : 7);

            for(let i=0; i<count; i++) {
                let growth = (tf === 'max' || tf === '1825') ? (i * 40) : 0;
                prices.push(base - growth - (Math.random() * 5));
                
                if(tf === '1') {
                    let d = new Date();
                    d.setHours(now.getHours() - (count - i));
                    labels.push(`${d.getHours()}:00`);
                }
                else if (tf === 'max' || tf === '1825') labels.push(now.getFullYear() - (count - 1 - i));
                else labels.push(`${now.getMonth()+1}/${now.getDate() - (count - i)}`);
            }
            if(tf === 'max' || tf === '1825') prices.sort((a,b) => a-b);
            prices[prices.length-1] = base;
            labels[labels.length-1] = (tf === '1') ? "Now" : (tf === 'max' || tf === '1825' ? now.getFullYear() : "Today");
            updateTrendUI(prices, labels);
        }

        function updateTrendUI(prices, labels) {
            const isUp = prices[prices.length - 1] >= prices[0];
            const color = isUp ? '#00c805' : '#ff3b30';
            trendChart.data.labels = labels;
            trendChart.data.datasets[0].data = prices;
            trendChart.data.datasets[0].borderColor = color;
            trendChart.data.datasets[0].backgroundColor = isUp ? 'rgba(0, 200, 5, 0.05)' : 'rgba(255, 59, 48, 0.05)';
            trendChart.update();
        }

        function initApp() {
            // ÂúìÈ§ÖÂúñÂàùÂßãÂåñ
            const colors = ['#84a59d', '#a8dadc', '#9eb3c2', '#b7b7a4', '#ddbea9', '#cb997e', '#b5838d', '#e5989b', '#ffb5a7', '#fcd5ce', '#f8ad9d', '#f4978e', '#bc4749', '#6b705c', '#a5a58d', '#b7b7a4', '#ffe8d6', '#ddbea9', '#cb997e', '#9b2226'];
            const top20 = { labels: ["NVIDIA", "Apple", "Microsoft", "Amazon", "Alphabet A", "Alphabet C", "Meta", "Broadcom", "Tesla", "Berkshire", "Walmart", "Eli Lilly", "JPMorgan", "ExxonMobil", "Visa", "J&J", "Micron", "Mastercard", "Oracle", "Costco"], values: [7.32, 6.14, 4.72, 3.60, 3.11, 2.91, 2.65, 2.55, 2.46, 1.71, 1.57, 1.52, 1.34, 1.00, 0.99, 0.93, 0.76, 0.75, 0.70, 0.70] };
            new Chart(document.getElementById('holdingsChart').getContext('2d'), {
                type: 'doughnut', data: { labels: top20.labels, datasets: [{ data: top20.values, backgroundColor: colors, borderWidth: 1, borderColor: '#fff' }] },
                options: { cutout: '70%', plugins: { legend: { display: false } } }
            });
            const legendDiv = document.getElementById('custom-legend');
            top20.labels.forEach((l, i) => legendDiv.innerHTML += `<div class="legend-item"><div class="color-box" style="background:${colors[i]}"></div><div style="flex:1; color:#000; font-weight:800">${l} <b style="float:right">${top20.values[i]}%</b></div></div>`);

            // Ë∂®Âã¢ÂúñÂàùÂßãÂåñ
            const ctxT = document.getElementById('trendChart').getContext('2d');
            trendChart = new Chart(ctxT, {
                type: 'line',
                data: { labels: [], datasets: [{ data: [], borderWidth: 3, pointRadius: 2, pointBackgroundColor: '#fff', tension: 0.2, fill: true }] },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        x: { display: true, ticks: { color: '#000', font: { weight: 'bold', size: 9 } } },
                        y: { display: true, position: 'right', ticks: { color: '#000', font: { weight: 'bold', size: 10 }, callback: v => '$' + v.toFixed(0) } }
                    }
                }
            });
            getVOOHistory();
        }

        function updateOdometer(priceStr) {
            const box = document.getElementById('digits-box');
            if (box.children.length === 0) {
                [...priceStr].forEach(char => {
                    const el = document.createElement('div');
                    if (char === '.') { el.className = 'decimal-point'; el.innerText = '.'; el.style.color = '#000'; }
                    else { el.className = 'digit-container'; el.innerHTML = `<div class="digit-strip"><span>0</span><span>1</span><span>2</span><span>3</span><span>4</span><span>5</span><span>6</span><span>7</span><span>8</span><span>9</span></div>`; }
                    box.appendChild(el);
                });
            }
            const strips = document.querySelectorAll('.digit-strip');
            const digits = [...priceStr].filter(c => c !== '.');
            digits.forEach((digit, i) => { if(strips[i]) strips[i].style.transform = `translateY(${-(parseInt(digit) * 80)}px)`; });
        }

        async function updatePrice() {
            try {
                const res = await fetch(`https://finnhub.io/api/v1/quote?symbol=${symbol}&token=${API_KEY}`);
                const data = await res.json();
                const price = data.c, change = data.d, percent = data.dp;
                if (!price) return;
                const priceStr = price.toFixed(2);
                updateOdometer(priceStr);
                lastPrice = price; // Êõ¥Êñ∞ÊúÄÊñ∞ÁúüÂØ¶ÁèæÂÉπ
                const cat = document.getElementById('cat-container');
                if (change >= 0) {
                    document.getElementById('change-display').className = 'up-text';
                    document.getElementById('arrow').innerText = '‚ñ≤';
                    cat.innerHTML = `<svg viewBox="0 0 100 100"><circle cx="50" cy="50" r="42" fill="#d1f7d6"/><text x="50" y="78" font-size="55" text-anchor="middle">üò∫</text></svg>`;
                    document.body.style.backgroundColor = "#f2faf5";
                } else {
                    document.getElementById('change-display').className = 'down-text';
                    document.getElementById('arrow').innerText = '‚ñº';
                    cat.innerHTML = `<svg viewBox="0 0 100 100"><circle cx="50" cy="50" r="42" fill="#ffdce0"/><text x="50" y="78" font-size="55" text-anchor="middle">üòø</text></svg>`;
                    document.body.style.backgroundColor = "#fef2f2";
                }
                document.getElementById('change-text').innerText = `${change>=0?'+':''}${change.toFixed(2)} (${percent.toFixed(2)}%)`;
            } catch (e) { console.error(e); }
        }

        initApp();
        updatePrice();
        setInterval(updatePrice, 15000);
    </script>
</body>
</html>
